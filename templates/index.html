<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Fact Quest</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>

<body>
    <!-- Background Animation -->
    <div class="bg-animation">
        <div class="floating-shape shape-1"></div>
        <div class="floating-shape shape-2"></div>
        <div class="floating-shape shape-3"></div>
        <div class="floating-shape shape-4"></div>
        <div class="floating-shape shape-5"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1 class="logo">
                <i class="fas fa-brain"></i>
                <span>Fact Quest</span>
            </h1>
            <div class="header-actions">
                <div class="language-selector">
                    <select id="headerLanguageSelect" class="language-select">
                        <option value="en">üá∫üá∏ English</option>
                        <option value="pl">üáµüá± Polski</option>
                    </select>
                </div>
                <button class="btn btn-outline" id="leaderboardBtn" data-translate="leaderboard">
                    <i class="fas fa-trophy"></i>
                    Leaderboard
                </button>
                <button class="btn btn-outline" id="statsBtn" data-translate="my_stats">
                    <i class="fas fa-chart-bar"></i>
                    My Stats
                </button>
            </div>
        </div>
    </header>

    <!-- Hamburger Menu Toggle -->
    <button class="hamburger-menu" id="hamburgerMenu" aria-label="Toggle navigation">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Swipe Indicator -->
    <div class="swipe-indicator" id="swipeIndicator">
        <div class="swipe-arrow"></div>
        <div class="swipe-text" data-translate="swipe_to_open">Swipe to open</div>
    </div>

    <!-- Mobile Navigation Panel -->
    <div class="mobile-nav-overlay" id="mobileNavOverlay"></div>
    <div class="mobile-nav-panel" id="mobileNavPanel">
        <div class="mobile-nav-header">
            <div class="mobile-nav-logo">
                <i class="fas fa-brain"></i>
                <span>Fact Quest</span>
            </div>
            <button class="mobile-nav-close" id="mobileNavClose" aria-label="Close navigation">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="mobile-nav-content">
            <div class="mobile-nav-section">
                <h4 data-translate="language">Language</h4>
                <div class="mobile-language-selector">
                    <select id="mobileLanguageSelect" class="language-select">
                        <option value="en">üá∫üá∏ English</option>
                        <option value="pl">üáµüá± Polski</option>
                    </select>
                </div>
            </div>

            <div class="mobile-nav-section">
                <div class="mobile-nav-actions">
                    <button class="btn btn-outline" id="mobileLeaderboardBtn" data-translate="leaderboard">
                        <i class="fas fa-trophy"></i>
                        Leaderboard
                    </button>
                    <button class="btn btn-outline" id="mobileStatsBtn" data-translate="my_stats">
                        <i class="fas fa-chart-bar"></i>
                        My Stats
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="screen active">
                <div class="welcome-card">
                    <div class="welcome-icon">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <h2 data-translate="welcome_title">Welcome to Fact Quest!</h2>
                    <p class="welcome-description" data-translate="welcome_description">
                        Test your knowledge across multiple categories. Get facts one by one and guess the answer.
                        The fewer facts you need, the higher your score!
                    </p>

                    <div class="player-setup">
                        <div class="input-group">
                            <label for="playerName" data-translate="your_name">Your Name</label>
                            <input type="text" id="playerName" data-translate-placeholder="enter_your_name"
                                placeholder="Enter your name" maxlength="50">
                        </div>

                        <div class="input-group">
                            <label for="categorySelect" data-translate="choose_category">Choose Category</label>
                            <select id="categorySelect">
                                <option value="" data-translate="loading_categories">Loading categories...</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label for="difficultySelect" data-translate="difficulty_level">Difficulty Level</label>
                            <select id="difficultySelect">
                                <option value="normal" data-translate="loading_difficulties">Loading difficulties...
                                </option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label for="roundsSelect" data-translate="number_of_rounds">Number of Rounds</label>
                            <select id="roundsSelect">
                                <option value="" data-translate="unlimited_rounds">‚ôæÔ∏è Unlimited Rounds</option>
                                <option value="1" data-translate="one_round">1 Round</option>
                                <option value="3" data-translate="three_rounds">3 Rounds</option>
                                <option value="5" data-translate="five_rounds">5 Rounds</option>
                                <option value="10" data-translate="ten_rounds">10 Rounds</option>
                            </select>
                        </div>

                        <div class="input-group" style="display: none;">
                            <label for="languageSelect" data-translate="language">Language</label>
                            <select id="languageSelect">
                                <option value="en">üá∫üá∏ English</option>
                                <option value="pl">üáµüá± Polski</option>
                            </select>
                        </div>

                        <button class="btn btn-primary btn-large" id="startGameBtn" data-translate="start_game"
                            disabled>
                            <i class="fas fa-play"></i>
                            Start Game
                        </button>

                        <button class="btn btn-primary btn-large" id="startOfflineGameBtn"
                            data-translate="start_offline_game" disabled>
                            <i class="fas fa-database"></i>
                            Start Offline Game
                        </button>

                        <!-- Offline Mode Section -->
                        <div class="offline-mode-section">
                            <div id="offlineStatus" class="offline-status" data-translate="offline_status_checking">
                                Checking offline availability...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Game Screen -->
            <div id="gameScreen" class="screen">
                <div class="game-layout">
                    <!-- Game Header -->
                    <div class="game-header">
                        <div class="player-info">
                            <div class="player-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div>
                                <h3 id="currentPlayer">Player</h3>
                            </div>
                        </div>

                        <div class="score-display">
                            <div class="score-item">
                                <span class="score-label" data-translate="round_score">Round Score</span>
                                <span class="score-value" id="roundScore">0</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label" data-translate="total_score">Total Score</span>
                                <span class="score-value" id="totalScore">0</span>
                            </div>
                            <div class="score-item" id="roundProgressDisplay" style="display: none;">
                                <span class="score-label" data-translate="round_progress">Round Progress</span>
                                <span class="score-value" id="roundProgress">1/5</span>
                            </div>
                        </div>
                    </div>

                    <!-- Game Content -->
                    <div class="game-content">
                        <!-- Facts Panel -->
                        <div class="facts-panel">
                            <div class="facts-header">
                                <h4>
                                    <i class="fas fa-lightbulb"></i>
                                    <span data-translate="facts_revealed">Facts Revealed</span>
                                </h4>
                                <div class="facts-counter">
                                    <span id="factsShown">0</span>/<span id="totalFacts">5</span>
                                </div>
                            </div>

                            <div class="facts-category">
                                <span class="category-main" id="currentCategory">-</span>
                                <span class="category-sub" id="currentSubCategory"></span>
                            </div>

                            <div class="facts-list" id="factsList">
                                <div class="no-facts">
                                    <i class="fas fa-question-circle"></i>
                                    <p data-translate="click_get_hint">Click "Get Hint" to reveal your first fact!</p>
                                </div>
                                <!-- Facts carousel for mobile -->
                                <div class="facts-carousel" id="factsCarousel" style="display: none;">
                                    <div class="facts-carousel-container" id="factsCarouselContainer">
                                        <!-- Facts will be dynamically inserted here -->
                                    </div>
                                    <div class="facts-navigation" id="factsNavigation">
                                        <!-- Navigation dots will be dynamically inserted here -->
                                    </div>
                                </div>
                            </div>

                            <div class="hint-buttons">
                                <button class="btn btn-secondary" id="getFactBtn" data-translate="get_hint">
                                    <i class="fas fa-eye"></i>
                                    Get Hint
                                </button>
                                <button class="btn btn-outline" id="getLetterHintBtn" data-translate="get_letter_hint">
                                    <i class="fas fa-font"></i>
                                    Get Letter Hint
                                </button>
                            </div>

                            <!-- Letter Hint Display -->
                            <div class="letter-hint-display" id="letterHintDisplay" style="display: none;">
                                <div class="hint-header">
                                    <i class="fas fa-lightbulb"></i>
                                    <span data-translate="letter_hint">Letter Hint</span>
                                </div>
                                <div class="hint-letters" id="hintLetters"></div>
                                <div class="hint-info">
                                    <span data-translate="hints_used">Hints Used</span>: <span
                                        id="hintsUsed">0</span>/<span id="maxHints">3</span>
                                </div>
                            </div>
                        </div>

                        <!-- Guess Panel -->
                        <div class="guess-panel">
                            <div class="guess-form">
                                <h4>
                                    <i class="fas fa-thinking"></i>
                                    <span data-translate="whats_your_guess">What's your guess?</span>
                                </h4>

                                <div class="input-group">
                                    <input type="text" id="guessInput" data-translate-placeholder="type_your_answer"
                                        placeholder="Type your answer here..." maxlength="100">
                                    <button class="btn btn-primary" id="submitGuessBtn" data-translate="submit">
                                        <i class="fas fa-paper-plane"></i>
                                        Submit
                                    </button>
                                </div>

                                <div class="guess-history" id="guessHistory">
                                    <!-- Mobile carousel structure (hidden on desktop) -->
                                    <div class="guess-carousel mobile-only" style="display: none;">
                                        <div class="guess-carousel-container" id="guessCarouselContainer">
                                            <!-- Guess items will be inserted here dynamically -->
                                        </div>
                                        <div class="guess-navigation" id="guessNavigation" style="display: none;">
                                            <!-- Navigation dots will be inserted here dynamically -->
                                        </div>
                                    </div>
                                    <!-- Desktop list structure (visible on desktop) -->
                                    <div class="guess-list desktop-only" id="guessListContainer">
                                        <!-- Guess items will be inserted here dynamically -->
                                    </div>
                                </div>
                            </div>

                            <!-- Game Controls -->
                            <div class="game-controls">
                                <button class="btn btn-ghost" id="giveUpBtn" data-translate="give_up">
                                    <i class="fas fa-flag"></i>
                                    Give Up
                                </button>
                                <button class="btn btn-ghost" id="backToMenuBtn" data-translate="main_menu">
                                    <i class="fas fa-home"></i>
                                    Main Menu
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Result Modal -->
            <div id="resultModal" class="modal">
                <div class="modal-content">
                    <div class="result-content">
                        <div class="result-icon" id="resultIcon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3 id="resultTitle" data-translate="congratulations">Congratulations!</h3>
                        <p id="resultMessage" data-translate="you_got_it_right">You got it right!</p>

                        <div class="result-stats">
                            <div class="stat-item">
                                <span class="stat-label" data-translate="answer">Answer</span>
                                <span class="stat-value" id="correctAnswer">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label" data-translate="round_score">Round Score</span>
                                <span class="stat-value" id="finalRoundScore">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label" data-translate="time_taken">Time Taken</span>
                                <span class="stat-value" id="timeTaken">0s</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label" data-translate="facts_used">Facts Used</span>
                                <span class="stat-value" id="factsUsed">0</span>
                            </div>
                        </div>

                        <div class="result-actions">
                            <button class="btn btn-primary" id="playAgainBtn" data-translate="play_again">
                                <i class="fas fa-play"></i>
                                Play Again
                            </button>
                            <button class="btn btn-outline" id="changePlayerBtn" data-translate="change_player">
                                <i class="fas fa-times-circle"></i>
                                Change Player
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Leaderboard Modal -->
            <div id="leaderboardModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 data-translate="global_leaderboard">
                            <i class="fas fa-trophy"></i>
                            Global Leaderboard
                        </h3>
                        <button class="close-btn" data-modal="leaderboardModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div id="leaderboardContent" class="leaderboard-content">
                            <div class="loading">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span data-translate="loading_leaderboard">Loading leaderboard...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Modal -->
            <div id="statsModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 data-translate="player_statistics">
                            <i class="fas fa-chart-bar"></i>
                            Player Statistics
                        </h3>
                        <button class="close-btn" data-modal="statsModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div id="statsContent" class="stats-content">
                            <div class="loading">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span data-translate="loading_statistics">Loading statistics...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Fact Quest</p>
        </div>
    </footer>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <!-- Emergency button fix -->
    <script>
        // Emergency validation override
        function emergencyButtonFix() {
            const nameInput = document.getElementById('playerName');
            const startBtn = document.getElementById('startGameBtn');
            const startOfflineBtn = document.getElementById('startOfflineGameBtn');

            if (nameInput && startBtn) {
                const hasName = nameInput.value.trim().length > 0;

                if (hasName) {
                    // Aggressive button enabling for start game button
                    startBtn.disabled = false;
                    startBtn.removeAttribute('disabled');
                    startBtn.classList.remove('disabled');
                    startBtn.style.opacity = '1';
                    startBtn.style.cursor = 'pointer';
                    startBtn.style.pointerEvents = 'auto';
                    startBtn.style.backgroundColor = '';

                    // Remove any inline styles that might disable it
                    if (startBtn.style.display === 'none') {
                        startBtn.style.display = '';
                    }

                    // Also enable offline game button if it exists
                    if (startOfflineBtn) {
                        startOfflineBtn.disabled = false;
                        startOfflineBtn.removeAttribute('disabled');
                        startOfflineBtn.classList.remove('disabled');
                        startOfflineBtn.style.opacity = '1';
                        startOfflineBtn.style.cursor = 'pointer';
                        startOfflineBtn.style.pointerEvents = 'auto';
                        startOfflineBtn.style.backgroundColor = '';

                        // Remove any inline styles that might disable it
                        if (startOfflineBtn.style.display === 'none') {
                            startOfflineBtn.style.display = '';
                        }
                    }

                    console.log('‚úÖ Buttons enabled - Name provided');
                } else {
                    startBtn.disabled = true;
                    startBtn.setAttribute('disabled', 'disabled');
                    startBtn.classList.add('disabled');

                    // Also disable offline game button if it exists
                    if (startOfflineBtn) {
                        startOfflineBtn.disabled = true;
                        startOfflineBtn.setAttribute('disabled', 'disabled');
                        startOfflineBtn.classList.add('disabled');
                    }

                    // Only log when name is actually cleared, not on every check
                    if (nameInput.value === '') {
                        console.log('‚ùå Buttons disabled - Name required');
                    }
                }
            }
        }

        // Run validation only on DOM ready and input events
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(emergencyButtonFix, 1000);

            // Add event listeners - only for name input changes
            const nameInput = document.getElementById('playerName');

            if (nameInput) {
                nameInput.addEventListener('input', emergencyButtonFix);
                nameInput.addEventListener('keyup', emergencyButtonFix);
                nameInput.addEventListener('change', emergencyButtonFix);
                nameInput.addEventListener('paste', function () {
                    // Small delay to ensure paste content is processed
                    setTimeout(emergencyButtonFix, 50);
                });
            }
        });
    </script>

    <!-- Main App JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>

</html>